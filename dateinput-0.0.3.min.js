/**
 * jQuery DateInput
 * *jQuery plugin that provides calendar-based date entry widget*
 *
 * @author Monwara LLC / Branko Vukelic <branko@herdhound.com>
 * @version 0.0.3
 */(function(a){a(function(a){function t(a,b){return a%b===0}function u(a){return t(a,4)||!t(a,100)||t(a,400)?!0:!1}function v(a,b){return a-=1,h[a]?h[a]:u(b)?29:28}function w(){return function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())}(new Date)}function x(a,b,c){var d=w();return d.getFullYear()===a&&d.getMonth()+1===b&&d.getDate()===c}function y(a,b,c){var d=w(),e=new Date(a,b-1,c);return e-d<0}function z(a,b){var c=a.getFullYear()*12+(a.getMonth()+1),d=c+b;return new Date(~~(d/12),d%12-1,a.getDate())}function A(a,b){return a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),12),a.setTime(a.getTime()+b*s),a.setHours(0),a}function B(a,b,f,g){function B(d){var e=[],f,h;if(d>m)return;for(h=0;h<7;h++){f=d+h+1;if(f>m)return e;e.push(c.replace("$PAST",g&&y(b,a,f)?i:"").replace("$TODAY",x(b,a,f)?j:"").replace("$YEAR",b).replace("$MONTH",a).replace("$DATE",f).replace("$LABEL",f))}return e}function C(a){return a&&w.push(a)}b=typeof b=="number"?b:(new Date).getFullYear(),f=typeof f=="boolean"?f:!0,g=typeof g=="boolean"?g:!1;var h,l,m=v(a,b),n,o,p,q,r,s;switch(a){case 1:n=12,o=b-1,q=2,r=b;break;case 12:n=11,o=b,q=1,r=b+1;break;default:n=a-1,o=r=b,q=a+1}p=v(n,o),s=v(q,r);var t=(new Date(b,a-1,1)).getDay(),u=f?t:t-1;u=u===-1?6:u;var w=[[]];for(h=u;h;h--){var z=p-h+1;w[0].push(d.replace("$PAST",g&&y(o,n,z)?i:"").replace("$TODAY",x(o,n,z)?j:"").replace("$YEAR",o).replace("$MONTH",n).replace("$DATE",z).replace("$LABEL",z))}for(h=1;h<=7-u;h++)w[0].push(c.replace("$PAST",g&&y(b,a,h)?i:"").replace("$TODAY",x(b,a,h)?j:"").replace("$YEAR",b).replace("$MONTH",a).replace("$DATE",h).replace("$LABEL",h));var A=~~((m-7+u)/7);(m-7+u)%7&&A++;for(h=0;h<A;h++)C(B(7-u+h*7));var D=w.length-1,E=7-w[D].length;for(h=1;h<=E;h++)w[D].push(d.replace("$PAST",g&&y(r,q,h)?i:"").replace("$TODAY",x(r,q,h)?j:"").replace("$YEAR",r).replace("$MONTH",q).replace("$DATE",h).replace("$LABEL",h));(function G(a,b,c){if(!a)return;b++,w[c]=[];for(h=0;h<7;h++)b+=h,w[c].push(d.replace("$PAST",g&&y(r,q,h)?i:"").replace("$TODAY",x(r,q,h)?j:"").replace("$YEAR",r).replace("$MONTH",q).replace("$DATE",b).replace("$LABEL",b));G(6-w.length,b,w.length)})(6-w.length,E,w.length);var F=f?0:6;return w=w.map(function(a){return a.map(function(a,b){return a.replace("$SUNDAY",F===b?k:"")})}),w.map(function(a){return e.replace("$CELLS",a.join(""))}).join("")}function E(a,b,c){var d={"%a":c[r[a.getDay()]],"%A":c[q[a.getDay()]],"%b":c[p[a.getMonth()]],"%B":c[o[a.getMonth()]],"%c":a.toLocaleString(),"%d":C(a.getDate(),2),"%D":a.getDate().toString(),"%H":C(a.getHours(),2,!0),"%i":D(a.getHours(),12),"%I":C(D(a.getHours(),12),2),"%m":C(a.getMonth()+1,2),"%M":C(a.getMinutes(),2,!0),"%N":a.getMinutes().toString(),"%p":a.getHours()>0&&a.getHours()<13?"am":"pm","%s":a.getSeconds().toString(),"%S":C(a.getSeconds(),2,!0),"%w":a.getDay().toString(),"%y":a.getFullYear().toString().slice(-2),"%Y":a.getFullYear().toString(),"%x":a.toLocaleDateString(),"%X":a.toLocaleTimeString(),"%z":""+Math.floor(a.getTimezoneOffset()/60)+a.getTimezoneOffset()%60,"%%":"%"};for(var e in d)b=b.replace(e,d[e]);return b}var b=a("jquery"),c='<a href="JavaScript:void(0);" class="dateinput-calendar-cell $PAST $TODAY $SUNDAY" data-year="$YEAR" data-month="$MONTH" data-date="$DATE">$LABEL</a>',d='<a href="JavaScript:void(0);" class="dateinput-calendar-cell dateinput-calendar-othermonth $PAST $TODAY $SUNDAY" data-year="$YEAR" data-month="$MONTH" data-date="$DATE">$LABEL</a>',e='<div class="dateinput-calendar-week">$CELLS</div>',f='<span class="dateinput-weekname $SUNDAY">$LABEL</span>',g=['<div class="dateinput-container">','<div class="dateinput-inner">','<div class="dateinput-monthbar">','<span class="dateinput-monthbar-month">$MONTH</span>','<span class="dateinput-monthbar-button dateinput-prevmonth">','<a class="dateinput-prevmonth" href="JavaScript:void(0)">&lt;</a>',"</span>",'<span class="dateinput-monthbar-button dateinput-nextmonth">','<a class="dateinput-nextmonth" href="JavaScript:void(0)">&gt;</a>',"</span>","</div>",'<div class="dateinput-calendar"><div class="dateinput-weeknames">',"$WEEKNAMES","</div>",'<div class="dateinput-calendar-weeks">$CALENDAR</div>',"</div>",'<div class="dateinput-help">$HELP</div>',"</div></div>"].join(""),h=[31,0,31,30,31,30,31,31,30,31,30,31],i="dateinput-past",j="dateinput-today",k="dateinput-sunday",l="dateinput-selected",m="ssun smon stue swed sthu sfri ssat".split(" "),n="jan feb mar apr may jun jul aug sep oct nov dec".split(" "),o="ljan lfeb lmar lapr lmay ljun ljul laug lsep loct lnov ldec".split(" "),p="jan feb mar apr may jun jul aug sep oct nov dec".split(" "),q="lsun lmon ltue lwed lthu lfri lsat".split(" "),r="sun mon tue wed thu fri sat".split(" "),s=864e5,C=function(a,b){return b=b>0?b:3,((new Array(1+b)).join("0")+a).slice(-b)},D=function(a,b,c){return c=typeof c=="undefined"?!1:c,a%b||c?0:b};b.fn.dateInput=function(a){b(this).each(function(c,d){function p(b){var c=a.labels[n[b.getMonth()]];return g.replace("$WEEKNAMES",weekDays).replace("$MONTH",c+" "+b.getFullYear()).replace("$CALENDAR",B(b.getMonth()+1,b.getFullYear(),a.sundayFirst,a.noPast))}function q(b){b=E(b,a.format,a.labels),e.val(b)}function s(a){if(!r)return;r.find("."+l).removeClass(l);if(!a)return;r.find(".dateinput-calendar-cell").each(function(c,d){d=b(d);if(d.hasClass(i))return;if(d.data("year")!=a.getFullYear())return;if(d.data("month")!=a.getMonth()+1)return;if(d.data("date")!=a.getDate())return;d.addClass(l)})}function u(c){r&&c?(r.find(".dateinput-monthbar-month").text(a.labels[n[c.getMonth()]]+" "+c.getFullYear()),r.find(".dateinput-calendar-weeks").html(B(c.getMonth()+1,c.getFullYear(),a.sundayFirst,a.noPast)),r.displayMonth=c.getMonth()+1,r.displayYear=c.getFullYear()):(r=b(p(c||j).replace("$HELP",a.inline?"":a.labels.help)),r.displayMonth=j.getMonth()+1,r.displayYear=j.getFullYear(),r.attr("id",(e.attr("id")||e.attr("name"))+"-dateinput"),a.zindex&&r.css("z-index",a.zindex),r.data("input",e),r.data("widget",r),a.inline&&r.css("display","inline-block"),r.on("contextmenu",function(b){b.preventDefault(),b.stopPropagation();var c=w();u(c),s(c),e.val(E(c,a.format,a.labels)),t&&clearTimeout(t),e.focus()}),r.on("click",".dateinput-calendar-cell",function(c){c.stopPropagation(),c.preventDefault();if(b(this).hasClass(i)){t&&clearTimeout(t),e.focus();return}var d=new Date(b(this).data("year"),b(this).data("month")-1,b(this).data("date"));if(!a.autoClose)t&&clearTimeout(t),e.focus();else{var f=e.closest("form").find(":input");f.eq(f.index(e)+1).focus()}s(d),typeof a.click=="funciton"&&a.click(d)?q(d):q(d)}),r.on("click",".dateinput-monthbar-button a",function(c){c.stopPropagation(),c.preventDefault();var d=b(this),f=d.hasClass("dateinput-prevmonth")?-1:1;(function(a){u(a)})(z(new Date(r.displayYear,r.displayMonth-1,1),f)),s(e.val()?new Date(e.val()):null),typeof a.monthChange=="function"&&a.month(newDate.getMonth()+1,newDate.getFullYear()),a.inline||(clearTimeout(t),e.focus())})),s(c)}var e=b(d),h={format:"%D %b %Y",autoClose:!1,inline:!1,noPast:!1,startDate:new Date,sundayFirst:!0,offset:4,fadeOut:200,labels:{ssun:"S",smon:"M",stue:"T",swed:"W",sthu:"T",sfri:"F",ssat:"S",sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat",lsun:"Sunday",lmon:"Monday",ltue:"Tuesday",lwed:"Wednesday",lthu:"Thursday",lfri:"Friday",lsat:"Saturday",jan:"Jan",feb:"Feb",mar:"Mar",apr:"Apr",may:"May",jun:"Jun",jul:"Jul",aug:"Aug",sep:"Sep",oct:"Oct",nov:"Nov",dec:"Dec",ljan:"January",lfeb:"February",lmar:"March",lapr:"April",ljun:"Jun",ljul:"July",laug:"August",lsep:"September",loct:"October",lnov:"November",ldec:"December",help:"Use Ctrl + arrow keys to navigate"}};a=b.extend(!0,{},h,a);var j=e.val()?new Date(e.val()):a.startDate;a.sundayFirst?weekDays=m:(weekDays=m.slice(1),weekDays.push(m[0]));var o=a.sundayFirst?0:6;weekDays=weekDays.map(function(b,c){return f.replace("$LABEL",a.labels[b]).replace("$SUNDAY",o===c?k:"")}).join("");var r,t;if(a.inline){var v=b('<input type="hidden" name="$NAME" id="$ID" value="$VAL">'.replace("$NAME",e.attr("name")).replace("$ID",e.attr("id")).replace("$VAL",e.val()));e.replaceWith(v),e=v,u(e.val()?new Date(e.val()):null),e.after(r)}else e.on("focus",function(c){if(r)return!0;(function(a){u(a),s(a)})(e.val()?new Date(e.val()):null),r.appendTo(document.body),r.css({position:"absolute",display:"block"});var d=b(document).scrollLeft(),f=b(document).scrollTop(),g=r.outerWidth(),h=r.outerHeight(),i=e.offset().left-d,j=e.offset().top-f,k=e.outerWidth(),l=e.outerHeight(),m=b(window).width(),n=b(window).height(),o=0,p=0;h+j+l+a.offset>n&&j-h-a.offset>0?p=j-h-a.offset+f:p=j+l+a.offset+f,i+g>m?o=i+k-g+d:o=i+d;if(typeof a.position=="function"){var q=a.position({input:{left:i,top:j,width:k,height:l},calendar:{left:o,top:p,width:g,height:h},viewport:{left:d,top:f,width:m,height:n}});o=q.left+d,p=q.top+f}r.css({left:o,top:p})}),e.on("blur",function(b){t=setTimeout(function(){if(!r)return;r.fadeOut(a.fadeOut,function(){r.remove(),r=undefined})},150)}),e.on("keydown",function(b){function c(c){if(!r)return;b.preventDefault(),b.stopPropagation(),e.val(E(c,a.format,a.labels)),u(c),s(c)}function d(b){var d=new Date(e.val());if(d.toString()==="Invalid Date")return;c(z(d,b)),typeof a.monthChange=="function"&&a.monthChange(d.getFullYear(),d.getMonth()+1)}function f(d){if(b.ctrlKey&&!b.shiftKey&&!b.altKey&&!b.modKey){var f=new Date(e.val());if(f.toString()==="Invalid Date")c(w());else{var g=A(f,d);if(a.noPast&&g-w()<0)return;console.log(g),c(g)}}}switch(b.which){case 13:if(!r)return;b.preventDefault(),b.stopPropagation(),r.fadeOut(a.fadeOut,function(){r.remove(),r=null});break;case 27:if(!r)return;b.stopPropagation(),b.preventDefault(),r.fadeOut(a.fadeOut,function(){r.remove(),r=undefined});break;case 33:d(-1);break;case 34:d(1);break;case 37:f(-1);break;case 38:f(-7);break;case 39:f(1);break;case 40:f(7)}}),e.on("keyup",function(a){if(!r)return;switch(a.which){case 8:case 9:case 13:case 16:case 17:case 18:case 20:case 27:case 32:case 35:case 36:case 37:case 38:case 39:case 40:case 45:case 144:return;default:var b=new Date(e.val());b.toString()==="Invalid Date"?s():u(b)}})})}})})(typeof define=="function"&&define.amd?define:function(a){a(function(){return jQuery})});