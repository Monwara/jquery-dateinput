/**
 * jQuery DateInput
 * *jQuery plugin that provides calendar-based date entry widget*
 *
 * @author Monwara LLC / Branko Vukelic <branko@monwara.com>
 * @version 0.0.5
 */(function(e,t){typeof define=="function"&&define.amd?define(["jquery"],t):t(e.jQuery)})(this,function(e){function w(e,t){return e%t===0}function E(e){return w(e,4)||!w(e,100)&&w(e,400)?!0:!1}function S(e,t){return e-=1,o[e]?o[e]:E(t)?29:28}function x(){return function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}(new Date)}function T(e,t,n){var r=x();return r.getFullYear()===e&&r.getMonth()+1===t&&r.getDate()===n}function N(e,t,n){var r=x(),i=new Date(e,t-1,n);return i-r<0}function C(e,t){return console.log(e,t),function(e){return e.setMonth(e.getMonth()+t),e}(new Date(e))}function k(e,t){return e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),12),e.setTime(e.getTime()+t*y),e.setHours(0),e}function L(e,i,s,o){function L(n){var r=[],s,f;if(n>p)return;for(f=0;f<7;f++){s=n+f+1;if(s>p)return r;r.push(t.replace("$PAST",o&&N(i,e,s)?u:"").replace("$TODAY",T(i,e,s)?a:"").replace("$YEAR",i).replace("$MONTH",e).replace("$DATE",s).replace("$LABEL",s))}return r}function A(e){return e&&x.push(e)}i=typeof i=="number"?i:(new Date).getFullYear(),s=typeof s=="boolean"?s:!0,o=typeof o=="boolean"?o:!1;var l,c,h,p=S(e,i),d,v,m,g,y,b;switch(e){case 1:d=12,v=i-1,g=2,y=i;break;case 12:d=11,v=i,g=1,y=i+1;break;default:d=e-1,v=y=i,g=e+1}m=S(d,v),b=S(g,y);var w=(new Date(i,e-1,1)).getDay(),E=s?w:w-1;E=E===-1?6:E;var x=[[]];for(l=E;l;l--){var C=m-l+1;x[0].push(n.replace("$PAST",o&&N(v,d,C)?u:"").replace("$TODAY",T(v,d,C)?a:"").replace("$YEAR",v).replace("$MONTH",d).replace("$DATE",C).replace("$LABEL",C))}for(l=1;l<=7-E;l++)x[0].push(t.replace("$PAST",o&&N(i,e,l)?u:"").replace("$TODAY",T(i,e,l)?a:"").replace("$YEAR",i).replace("$MONTH",e).replace("$DATE",l).replace("$LABEL",l));var k=~~((p-7+E)/7);(p-7+E)%7&&k++;for(l=0;l<k;l++)A(L(7-E+l*7));var O=x.length-1,M=7-x[O].length,_=0;for(l=1;l<=M;l++)x[O].push(n.replace("$PAST",o&&N(y,g,l)?u:"").replace("$TODAY",T(y,g,l)?a:"").replace("$YEAR",y).replace("$MONTH",g).replace("$DATE",l).replace("$LABEL",l)),_=l;if(x.length<=6)for(c=x.length;c<=6;c++){x[c]=[];for(l=0;l<7;l++)_++,x[c].push(n.replace("$PAST",o&&N(y,g,l)?u:"").replace("$TODAY",T(y,g,l)?a:"").replace("$YEAR",y).replace("$MONTH",g).replace("$DATE",_).replace("$LABEL",_))}var D=s?0:6;return x=x.map(function(e){return e.map(function(e,t){return e.replace("$SUNDAY",D===t?f:"")})}),x.map(function(e){return r.replace("$CELLS",e.join(""))}).join("")}function M(e,t,n){var r={"%a":n[g[e.getDay()]],"%A":n[m[e.getDay()]],"%b":n[v[e.getMonth()]],"%B":n[d[e.getMonth()]],"%c":e.toLocaleString(),"%d":A(e.getDate(),2),"%D":e.getDate().toString(),"%H":A(e.getHours(),2,!0),"%i":O(e.getHours(),12),"%I":A(O(e.getHours(),12),2),"%m":A(e.getMonth()+1,2),"%M":A(e.getMinutes(),2,!0),"%N":e.getMinutes().toString(),"%p":e.getHours()>0&&e.getHours()<13?"am":"pm","%s":e.getSeconds().toString(),"%S":A(e.getSeconds(),2,!0),"%w":e.getDay().toString(),"%y":e.getFullYear().toString().slice(-2),"%Y":e.getFullYear().toString(),"%x":e.toLocaleDateString(),"%X":e.toLocaleTimeString(),"%z":""+Math.floor(e.getTimezoneOffset()/60)+e.getTimezoneOffset()%60,"%%":"%"};for(var i in r)t=t.replace(i,r[i]);return t}var t='<a href="JavaScript:void(0);" class="dateinput-calendar-cell $PAST $TODAY $SUNDAY" data-year="$YEAR" data-month="$MONTH" data-date="$DATE">$LABEL</a>',n='<a href="JavaScript:void(0);" class="dateinput-calendar-cell dateinput-calendar-othermonth $PAST $TODAY $SUNDAY" data-year="$YEAR" data-month="$MONTH" data-date="$DATE">$LABEL</a>',r='<div class="dateinput-calendar-week">$CELLS</div>',i='<span class="dateinput-weekname $SUNDAY">$LABEL</span>',s=['<div class="dateinput-container $INLINE">','<div class="dateinput-inner">','<div class="dateinput-monthbar">','<span class="dateinput-monthbar-month">$MONTH</span>','<span class="dateinput-monthbar-button dateinput-prevmonth">','<a class="dateinput-prevmonth" href="JavaScript:void(0)">&lt;</a>',"</span>",'<span class="dateinput-monthbar-button dateinput-nextmonth">','<a class="dateinput-nextmonth" href="JavaScript:void(0)">&gt;</a>',"</span>","</div>",'<div class="dateinput-calendar"><div class="dateinput-weeknames">',"$WEEKNAMES","</div>",'<div class="dateinput-calendar-weeks">$CALENDAR</div>',"</div>",'<div class="dateinput-help">$HELP</div>',"</div></div>"].join(""),o=[31,0,31,30,31,30,31,31,30,31,30,31],u="dateinput-past",a="dateinput-today",f="dateinput-sunday",l="dateinput-selected",c="dateinput-inline",h="ssun smon stue swed sthu sfri ssat".split(" "),p="jan feb mar apr may jun jul aug sep oct nov dec".split(" "),d="ljan lfeb lmar lapr lmay ljun ljul laug lsep loct lnov ldec".split(" "),v="jan feb mar apr may jun jul aug sep oct nov dec".split(" "),m="lsun lmon ltue lwed lthu lfri lsat".split(" "),g="sun mon tue wed thu fri sat".split(" "),y=864e5,b="dateinput-calendar-othermonth",A=function(e,t){return t=t>0?t:3,((new Array(1+t)).join("0")+e).slice(-t)},O=function(e,t,n){return n=typeof n=="undefined"?!1:n,e%t||n?0:t};e.fn.dateInput=function(t){e(this).each(function(n,r){function m(e,n){var r=t.labels[p[e.getMonth()]];return s.replace("$INLINE",n?c:"").replace("$WEEKNAMES",weekDays).replace("$MONTH",r+" "+e.getFullYear()).replace("$CALENDAR",L(e.getMonth()+1,e.getFullYear(),t.sundayFirst,t.noPast))}function g(e){e=M(e,t.format,t.labels),o.val(e),o.change()}function w(t){if(!y)return;y.find("."+l).removeClass(l);if(!t)return;y.find(".dateinput-calendar-cell").each(function(n,r){r=e(r);if(r.hasClass(u))return;if(r.data("year")!=t.getFullYear())return;if(r.data("month")!=t.getMonth()+1)return;if(r.data("date")!=t.getDate())return;r.addClass(l)})}function S(n){if(y&&n)y.find(".dateinput-monthbar-month").text(t.labels[p[n.getMonth()]]+" "+n.getFullYear()),y.find(".dateinput-calendar-weeks").html(L(n.getMonth()+1,n.getFullYear(),t.sundayFirst,t.noPast)),y.data("displayMonth",n.getMonth()),y.data("displayYear",n.getFullYear());else{y=e(m(n||d,t.inline).replace("$HELP",t.inline?"":t.labels.help)),y.data("displayMonth",d.getMonth()),y.data("displayYear",d.getFullYear()),y.attr("id",(o.attr("id")||o.attr("name"))+"-dateinput"),t.zindex&&y.css("z-index",t.zindex),y.data("input",o),y.data("widget",y),t.inline&&y.css("display","inline-block");function r(e){(function(e){S(e)})(C(new Date(y.data("displayYear"),y.data("displayMonth"),1),e)),w(o.val()?new Date(o.val()):null),typeof t.monthChange=="function"&&t.month(newDate.getMonth()+1,newDate.getFullYear()),t.inline||(clearTimeout(E),o.focus())}y.on("contextmenu",function(e){e.preventDefault(),e.stopPropagation();var n=x();S(n),w(n),o.val(M(n,t.format,t.labels)),o.change(),E&&clearTimeout(E),o.focus()}),y.on("click",".dateinput-calendar-cell",function(n){n.stopPropagation(),n.preventDefault();if(e(this).hasClass(u)){E&&clearTimeout(E),o.focus();return}e(this).hasClass(b)&&r(e(this).data("month")>y.data("displayMonth")?1:-1);var i=new Date(e(this).data("year"),e(this).data("month")-1,e(this).data("date"));if(!t.autoClose)E&&clearTimeout(E),o.focus();else{var s=o.closest("form").find(":input");s.eq(s.index(o)+1).focus()}w(i),typeof t.click=="funciton"&&t.click(i)?g(i):g(i)}),y.on("click",".dateinput-monthbar-button a",function(t){t.stopPropagation(),t.preventDefault();var n=e(this);r(n.hasClass("dateinput-prevmonth")?-1:1)})}w(n)}var o=e(r),a={format:"%D %b %Y",autoClose:!1,inline:!1,noPast:!1,startDate:new Date,sundayFirst:!0,offset:4,fadeOut:200,arrowsOnly:!1,labels:{ssun:"S",smon:"M",stue:"T",swed:"W",sthu:"T",sfri:"F",ssat:"S",sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat",lsun:"Sunday",lmon:"Monday",ltue:"Tuesday",lwed:"Wednesday",lthu:"Thursday",lfri:"Friday",lsat:"Saturday",jan:"Jan",feb:"Feb",mar:"Mar",apr:"Apr",may:"May",jun:"Jun",jul:"Jul",aug:"Aug",sep:"Sep",oct:"Oct",nov:"Nov",dec:"Dec",ljan:"January",lfeb:"February",lmar:"March",lapr:"April",ljun:"Jun",ljul:"July",laug:"August",lsep:"September",loct:"October",lnov:"November",ldec:"December",help:"Use Ctrl + arrow keys to navigate"}};t=e.extend(!0,{},a,t);var d=o.val()?new Date(o.val()):t.startDate;t.sundayFirst?weekDays=h:(weekDays=h.slice(1),weekDays.push(h[0]));var v=t.sundayFirst?0:6;weekDays=weekDays.map(function(e,n){return i.replace("$LABEL",t.labels[e]).replace("$SUNDAY",v===n?f:"")}).join("");var y,E;if(t.inline){var T=e('<input type="hidden" name="$NAME" id="$ID" value="$VAL">'.replace("$NAME",o.attr("name")).replace("$ID",o.attr("id")).replace("$VAL",o.val()));o.replaceWith(T),o=T,S(o.val()?new Date(o.val()):null),o.after(y)}else t.arrowsOnly&&o.attr("autocomplete","off"),o.on("focus",function(n){if(y)return!0;(function(e){S(e),w(e)})(o.val()?new Date(o.val()):null),y.appendTo(document.body),y.css({position:"absolute",display:"block"});var r=e(document).scrollLeft(),i=e(document).scrollTop(),s=y.outerWidth(),u=y.outerHeight(),a=o.offset().left-r,f=o.offset().top-i,l=o.outerWidth(),c=o.outerHeight(),h=e(window).width(),p=e(window).height(),d=0,v=0;u+f+c+t.offset>p&&f-u-t.offset>0?v=f-u-t.offset+i:v=f+c+t.offset+i,a+s>h?d=a+l-s+r:d=a+r;if(typeof t.position=="function"){var m=t.position({input:{left:a,top:f,width:l,height:c},calendar:{left:d,top:v,width:s,height:u},viewport:{left:r,top:i,width:h,height:p}});d=m.left+r,v=m.top+i}y.css({left:d,top:v})}),o.on("blur",function(e){E=setTimeout(function(){if(!y)return;y.fadeOut(t.fadeOut,function(){y.remove(),y=undefined})},150)}),o.on("keydown",function(e){function n(n){if(!y)return;e.preventDefault(),e.stopPropagation(),o.val(M(n,t.format,t.labels)),S(n),w(n)}function r(e){var r=new Date(o.val());if(r.toString()==="Invalid Date")return;n(C(r,e)),typeof t.monthChange=="function"&&t.monthChange(r.getFullYear(),r.getMonth()+1)}function i(r){if(t.arrowsOnly||e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.modKey){e.preventDefault(),e.stopPropagation();var i=new Date(o.val());if(i.toString()==="Invalid Date")n(x());else{var s=k(i,r);if(t.noPast&&s-x()<0)return;console.log(s),n(s)}}}switch(e.which){case 13:if(!y)return;e.preventDefault(),e.stopPropagation(),y.fadeOut(t.fadeOut,function(){y.remove(),y=null});break;case 27:if(!y)return;e.stopPropagation(),e.preventDefault(),y.fadeOut(t.fadeOut,function(){y.remove(),y=undefined});break;case 33:r(-1);break;case 34:r(1);break;case 37:i(-1);break;case 38:i(-7);break;case 39:i(1);break;case 40:i(7)}}),o.on("keyup",function(e){if(!y)return;switch(e.which){case 8:case 9:case 13:case 16:case 17:case 18:case 20:case 27:case 32:case 35:case 36:case 37:case 38:case 39:case 40:case 45:case 144:return;default:var t=new Date(o.val());t.toString()==="Invalid Date"?w():S(t)}})})}});