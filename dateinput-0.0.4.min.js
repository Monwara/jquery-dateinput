/**
 * jQuery DateInput
 * *jQuery plugin that provides calendar-based date entry widget*
 *
 * @author Monwara LLC / Branko Vukelic <branko@herdhound.com>
 * @version 0.0.4
 */(function(a){a(function(a){function v(a,b){return a%b===0}function w(a){return v(a,4)||!v(a,100)||v(a,400)?!0:!1}function x(a,b){return a-=1,h[a]?h[a]:w(b)?29:28}function y(){return function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())}(new Date)}function z(a,b,c){var d=y();return d.getFullYear()===a&&d.getMonth()+1===b&&d.getDate()===c}function A(a,b,c){var d=y(),e=new Date(a,b-1,c);return e-d<0}function B(a,b){var c=a.getFullYear()*12+(a.getMonth()+1),d=c+b;return new Date(~~(d/12),d%12-1,a.getDate())}function C(a,b){return a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),12),a.setTime(a.getTime()+b*t),a.setHours(0),a}function D(a,b,f,g){function C(d){var e=[],f,h;if(d>n)return;for(h=0;h<7;h++){f=d+h+1;if(f>n)return e;e.push(c.replace("$PAST",g&&A(b,a,f)?i:"").replace("$TODAY",z(b,a,f)?j:"").replace("$YEAR",b).replace("$MONTH",a).replace("$DATE",f).replace("$LABEL",f))}return e}function D(a){return a&&w.push(a)}b=typeof b=="number"?b:(new Date).getFullYear(),f=typeof f=="boolean"?f:!0,g=typeof g=="boolean"?g:!1;var h,l,m,n=x(a,b),o,p,q,r,s,t;switch(a){case 1:o=12,p=b-1,r=2,s=b;break;case 12:o=11,p=b,r=1,s=b+1;break;default:o=a-1,p=s=b,r=a+1}q=x(o,p),t=x(r,s);var u=(new Date(b,a-1,1)).getDay(),v=f?u:u-1;v=v===-1?6:v;var w=[[]];for(h=v;h;h--){var y=q-h+1;w[0].push(d.replace("$PAST",g&&A(p,o,y)?i:"").replace("$TODAY",z(p,o,y)?j:"").replace("$YEAR",p).replace("$MONTH",o).replace("$DATE",y).replace("$LABEL",y))}for(h=1;h<=7-v;h++)w[0].push(c.replace("$PAST",g&&A(b,a,h)?i:"").replace("$TODAY",z(b,a,h)?j:"").replace("$YEAR",b).replace("$MONTH",a).replace("$DATE",h).replace("$LABEL",h));var B=~~((n-7+v)/7);(n-7+v)%7&&B++;for(h=0;h<B;h++)D(C(7-v+h*7));var E=w.length-1,F=7-w[E].length,G=0;for(h=1;h<=F;h++)w[E].push(d.replace("$PAST",g&&A(s,r,h)?i:"").replace("$TODAY",z(s,r,h)?j:"").replace("$YEAR",s).replace("$MONTH",r).replace("$DATE",h).replace("$LABEL",h)),G=h;if(w.length<=6)for(l=w.length;l<=6;l++){w[l]=[];for(h=0;h<7;h++)G++,w[l].push(d.replace("$PAST",g&&A(s,r,h)?i:"").replace("$TODAY",z(s,r,h)?j:"").replace("$YEAR",s).replace("$MONTH",r).replace("$DATE",G).replace("$LABEL",G))}var H=f?0:6;return w=w.map(function(a){return a.map(function(a,b){return a.replace("$SUNDAY",H===b?k:"")})}),w.map(function(a){return e.replace("$CELLS",a.join(""))}).join("")}function G(a,b,c){var d={"%a":c[s[a.getDay()]],"%A":c[r[a.getDay()]],"%b":c[q[a.getMonth()]],"%B":c[p[a.getMonth()]],"%c":a.toLocaleString(),"%d":E(a.getDate(),2),"%D":a.getDate().toString(),"%H":E(a.getHours(),2,!0),"%i":F(a.getHours(),12),"%I":E(F(a.getHours(),12),2),"%m":E(a.getMonth()+1,2),"%M":E(a.getMinutes(),2,!0),"%N":a.getMinutes().toString(),"%p":a.getHours()>0&&a.getHours()<13?"am":"pm","%s":a.getSeconds().toString(),"%S":E(a.getSeconds(),2,!0),"%w":a.getDay().toString(),"%y":a.getFullYear().toString().slice(-2),"%Y":a.getFullYear().toString(),"%x":a.toLocaleDateString(),"%X":a.toLocaleTimeString(),"%z":""+Math.floor(a.getTimezoneOffset()/60)+a.getTimezoneOffset()%60,"%%":"%"};for(var e in d)b=b.replace(e,d[e]);return b}var b=a("jquery"),c='<a href="JavaScript:void(0);" class="dateinput-calendar-cell $PAST $TODAY $SUNDAY" data-year="$YEAR" data-month="$MONTH" data-date="$DATE">$LABEL</a>',d='<a href="JavaScript:void(0);" class="dateinput-calendar-cell dateinput-calendar-othermonth $PAST $TODAY $SUNDAY" data-year="$YEAR" data-month="$MONTH" data-date="$DATE">$LABEL</a>',e='<div class="dateinput-calendar-week">$CELLS</div>',f='<span class="dateinput-weekname $SUNDAY">$LABEL</span>',g=['<div class="dateinput-container $INLINE">','<div class="dateinput-inner">','<div class="dateinput-monthbar">','<span class="dateinput-monthbar-month">$MONTH</span>','<span class="dateinput-monthbar-button dateinput-prevmonth">','<a class="dateinput-prevmonth" href="JavaScript:void(0)">&lt;</a>',"</span>",'<span class="dateinput-monthbar-button dateinput-nextmonth">','<a class="dateinput-nextmonth" href="JavaScript:void(0)">&gt;</a>',"</span>","</div>",'<div class="dateinput-calendar"><div class="dateinput-weeknames">',"$WEEKNAMES","</div>",'<div class="dateinput-calendar-weeks">$CALENDAR</div>',"</div>",'<div class="dateinput-help">$HELP</div>',"</div></div>"].join(""),h=[31,0,31,30,31,30,31,31,30,31,30,31],i="dateinput-past",j="dateinput-today",k="dateinput-sunday",l="dateinput-selected",m="dateinput-inline",n="ssun smon stue swed sthu sfri ssat".split(" "),o="jan feb mar apr may jun jul aug sep oct nov dec".split(" "),p="ljan lfeb lmar lapr lmay ljun ljul laug lsep loct lnov ldec".split(" "),q="jan feb mar apr may jun jul aug sep oct nov dec".split(" "),r="lsun lmon ltue lwed lthu lfri lsat".split(" "),s="sun mon tue wed thu fri sat".split(" "),t=864e5,u="dateinput-calendar-othermonth",E=function(a,b){return b=b>0?b:3,((new Array(1+b)).join("0")+a).slice(-b)},F=function(a,b,c){return c=typeof c=="undefined"?!1:c,a%b||c?0:b};b.fn.dateInput=function(a){b(this).each(function(c,d){function q(b,c){var d=a.labels[o[b.getMonth()]];return g.replace("$INLINE",c?m:"").replace("$WEEKNAMES",weekDays).replace("$MONTH",d+" "+b.getFullYear()).replace("$CALENDAR",D(b.getMonth()+1,b.getFullYear(),a.sundayFirst,a.noPast))}function r(b){b=G(b,a.format,a.labels),e.val(b),e.change()}function t(a){if(!s)return;s.find("."+l).removeClass(l);if(!a)return;s.find(".dateinput-calendar-cell").each(function(c,d){d=b(d);if(d.hasClass(i))return;if(d.data("year")!=a.getFullYear())return;if(d.data("month")!=a.getMonth()+1)return;if(d.data("date")!=a.getDate())return;d.addClass(l)})}function w(c){if(s&&c)s.find(".dateinput-monthbar-month").text(a.labels[o[c.getMonth()]]+" "+c.getFullYear()),s.find(".dateinput-calendar-weeks").html(D(c.getMonth()+1,c.getFullYear(),a.sundayFirst,a.noPast)),s.displayMonth=c.getMonth()+1,s.displayYear=c.getFullYear();else{s=b(q(c||j,a.inline).replace("$HELP",a.inline?"":a.labels.help)),s.displayMonth=j.getMonth()+1,s.displayYear=j.getFullYear(),s.attr("id",(e.attr("id")||e.attr("name"))+"-dateinput"),a.zindex&&s.css("z-index",a.zindex),s.data("input",e),s.data("widget",s),a.inline&&s.css("display","inline-block");function d(b){(function(a){w(a)})(B(new Date(s.displayYear,s.displayMonth-1,1),b)),t(e.val()?new Date(e.val()):null),typeof a.monthChange=="function"&&a.month(newDate.getMonth()+1,newDate.getFullYear()),a.inline||(clearTimeout(v),e.focus())}s.on("contextmenu",function(b){b.preventDefault(),b.stopPropagation();var c=y();w(c),t(c),e.val(G(c,a.format,a.labels)),e.change(),v&&clearTimeout(v),e.focus()}),s.on("click",".dateinput-calendar-cell",function(c){c.stopPropagation(),c.preventDefault();if(b(this).hasClass(i)){v&&clearTimeout(v),e.focus();return}b(this).hasClass(u)&&d(b(this).data("month")>s.displayMonth?1:-1);var f=new Date(b(this).data("year"),b(this).data("month")-1,b(this).data("date"));if(!a.autoClose)v&&clearTimeout(v),e.focus();else{var g=e.closest("form").find(":input");g.eq(g.index(e)+1).focus()}t(f),typeof a.click=="funciton"&&a.click(f)?r(f):r(f)}),s.on("click",".dateinput-monthbar-button a",function(a){a.stopPropagation(),a.preventDefault();var c=b(this);d(c.hasClass("dateinput-prevmonth")?-1:1)})}t(c)}var e=b(d),h={format:"%D %b %Y",autoClose:!1,inline:!1,noPast:!1,startDate:new Date,sundayFirst:!0,offset:4,fadeOut:200,arrowsOnly:!1,labels:{ssun:"S",smon:"M",stue:"T",swed:"W",sthu:"T",sfri:"F",ssat:"S",sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat",lsun:"Sunday",lmon:"Monday",ltue:"Tuesday",lwed:"Wednesday",lthu:"Thursday",lfri:"Friday",lsat:"Saturday",jan:"Jan",feb:"Feb",mar:"Mar",apr:"Apr",may:"May",jun:"Jun",jul:"Jul",aug:"Aug",sep:"Sep",oct:"Oct",nov:"Nov",dec:"Dec",ljan:"January",lfeb:"February",lmar:"March",lapr:"April",ljun:"Jun",ljul:"July",laug:"August",lsep:"September",loct:"October",lnov:"November",ldec:"December",help:"Use Ctrl + arrow keys to navigate"}};a=b.extend(!0,{},h,a);var j=e.val()?new Date(e.val()):a.startDate;a.sundayFirst?weekDays=n:(weekDays=n.slice(1),weekDays.push(n[0]));var p=a.sundayFirst?0:6;weekDays=weekDays.map(function(b,c){return f.replace("$LABEL",a.labels[b]).replace("$SUNDAY",p===c?k:"")}).join("");var s,v;if(a.inline){var x=b('<input type="hidden" name="$NAME" id="$ID" value="$VAL">'.replace("$NAME",e.attr("name")).replace("$ID",e.attr("id")).replace("$VAL",e.val()));e.replaceWith(x),e=x,w(e.val()?new Date(e.val()):null),e.after(s)}else a.arrowsOnly&&e.attr("autocomplete","off"),e.on("focus",function(c){if(s)return!0;(function(a){w(a),t(a)})(e.val()?new Date(e.val()):null),s.appendTo(document.body),s.css({position:"absolute",display:"block"});var d=b(document).scrollLeft(),f=b(document).scrollTop(),g=s.outerWidth(),h=s.outerHeight(),i=e.offset().left-d,j=e.offset().top-f,k=e.outerWidth(),l=e.outerHeight(),m=b(window).width(),n=b(window).height(),o=0,p=0;h+j+l+a.offset>n&&j-h-a.offset>0?p=j-h-a.offset+f:p=j+l+a.offset+f,i+g>m?o=i+k-g+d:o=i+d;if(typeof a.position=="function"){var q=a.position({input:{left:i,top:j,width:k,height:l},calendar:{left:o,top:p,width:g,height:h},viewport:{left:d,top:f,width:m,height:n}});o=q.left+d,p=q.top+f}s.css({left:o,top:p})}),e.on("blur",function(b){v=setTimeout(function(){if(!s)return;s.fadeOut(a.fadeOut,function(){s.remove(),s=undefined})},150)}),e.on("keydown",function(b){function c(c){if(!s)return;b.preventDefault(),b.stopPropagation(),e.val(G(c,a.format,a.labels)),w(c),t(c)}function d(b){var d=new Date(e.val());if(d.toString()==="Invalid Date")return;c(B(d,b)),typeof a.monthChange=="function"&&a.monthChange(d.getFullYear(),d.getMonth()+1)}function f(d){if(a.arrowsOnly||b.ctrlKey&&!b.shiftKey&&!b.altKey&&!b.modKey){b.preventDefault(),b.stopPropagation();var f=new Date(e.val());if(f.toString()==="Invalid Date")c(y());else{var g=C(f,d);if(a.noPast&&g-y()<0)return;console.log(g),c(g)}}}switch(b.which){case 13:if(!s)return;b.preventDefault(),b.stopPropagation(),s.fadeOut(a.fadeOut,function(){s.remove(),s=null});break;case 27:if(!s)return;b.stopPropagation(),b.preventDefault(),s.fadeOut(a.fadeOut,function(){s.remove(),s=undefined});break;case 33:d(-1);break;case 34:d(1);break;case 37:f(-1);break;case 38:f(-7);break;case 39:f(1);break;case 40:f(7)}}),e.on("keyup",function(a){if(!s)return;switch(a.which){case 8:case 9:case 13:case 16:case 17:case 18:case 20:case 27:case 32:case 35:case 36:case 37:case 38:case 39:case 40:case 45:case 144:return;default:var b=new Date(e.val());b.toString()==="Invalid Date"?t():w(b)}})})}})})(typeof define=="function"&&define.amd?define:function(a){a(function(){return jQuery})});