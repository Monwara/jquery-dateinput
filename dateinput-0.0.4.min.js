/**
 * jQuery DateInput
 * *jQuery plugin that provides calendar-based date entry widget*
 *
 * @author Monwara LLC / Branko Vukelic <branko@monwara.com>
 * @version 0.0.4
 */(function(a,b){typeof define=="function"&&define.amd?define(["jquery"],b):b(a.jQuery)})(this,function(a){function u(a,b){return a%b===0}function v(a){return u(a,4)||!u(a,100)||u(a,400)?!0:!1}function w(a,b){return a-=1,g[a]?g[a]:v(b)?29:28}function x(){return function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())}(new Date)}function y(a,b,c){var d=x();return d.getFullYear()===a&&d.getMonth()+1===b&&d.getDate()===c}function z(a,b,c){var d=x(),e=new Date(a,b-1,c);return e-d<0}function A(a,b){var c=a.getFullYear()*12+(a.getMonth()+1),d=c+b;return new Date(~~(d/12),d%12-1,a.getDate())}function B(a,b){return a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),12),a.setTime(a.getTime()+b*s),a.setHours(0),a}function C(a,e,f,g){function C(c){var d=[],f,j;if(c>n)return;for(j=0;j<7;j++){f=c+j+1;if(f>n)return d;d.push(b.replace("$PAST",g&&z(e,a,f)?h:"").replace("$TODAY",y(e,a,f)?i:"").replace("$YEAR",e).replace("$MONTH",a).replace("$DATE",f).replace("$LABEL",f))}return d}function D(a){return a&&x.push(a)}e=typeof e=="number"?e:(new Date).getFullYear(),f=typeof f=="boolean"?f:!0,g=typeof g=="boolean"?g:!1;var k,l,m,n=w(a,e),o,p,q,r,s,t;switch(a){case 1:o=12,p=e-1,r=2,s=e;break;case 12:o=11,p=e,r=1,s=e+1;break;default:o=a-1,p=s=e,r=a+1}q=w(o,p),t=w(r,s);var u=(new Date(e,a-1,1)).getDay(),v=f?u:u-1;v=v===-1?6:v;var x=[[]];for(k=v;k;k--){var A=q-k+1;x[0].push(c.replace("$PAST",g&&z(p,o,A)?h:"").replace("$TODAY",y(p,o,A)?i:"").replace("$YEAR",p).replace("$MONTH",o).replace("$DATE",A).replace("$LABEL",A))}for(k=1;k<=7-v;k++)x[0].push(b.replace("$PAST",g&&z(e,a,k)?h:"").replace("$TODAY",y(e,a,k)?i:"").replace("$YEAR",e).replace("$MONTH",a).replace("$DATE",k).replace("$LABEL",k));var B=~~((n-7+v)/7);(n-7+v)%7&&B++;for(k=0;k<B;k++)D(C(7-v+k*7));var E=x.length-1,F=7-x[E].length,G=0;for(k=1;k<=F;k++)x[E].push(c.replace("$PAST",g&&z(s,r,k)?h:"").replace("$TODAY",y(s,r,k)?i:"").replace("$YEAR",s).replace("$MONTH",r).replace("$DATE",k).replace("$LABEL",k)),G=k;if(x.length<=6)for(l=x.length;l<=6;l++){x[l]=[];for(k=0;k<7;k++)G++,x[l].push(c.replace("$PAST",g&&z(s,r,k)?h:"").replace("$TODAY",y(s,r,k)?i:"").replace("$YEAR",s).replace("$MONTH",r).replace("$DATE",G).replace("$LABEL",G))}var H=f?0:6;return x=x.map(function(a){return a.map(function(a,b){return a.replace("$SUNDAY",H===b?j:"")})}),x.map(function(a){return d.replace("$CELLS",a.join(""))}).join("")}function F(a,b,c){var d={"%a":c[r[a.getDay()]],"%A":c[q[a.getDay()]],"%b":c[p[a.getMonth()]],"%B":c[o[a.getMonth()]],"%c":a.toLocaleString(),"%d":D(a.getDate(),2),"%D":a.getDate().toString(),"%H":D(a.getHours(),2,!0),"%i":E(a.getHours(),12),"%I":D(E(a.getHours(),12),2),"%m":D(a.getMonth()+1,2),"%M":D(a.getMinutes(),2,!0),"%N":a.getMinutes().toString(),"%p":a.getHours()>0&&a.getHours()<13?"am":"pm","%s":a.getSeconds().toString(),"%S":D(a.getSeconds(),2,!0),"%w":a.getDay().toString(),"%y":a.getFullYear().toString().slice(-2),"%Y":a.getFullYear().toString(),"%x":a.toLocaleDateString(),"%X":a.toLocaleTimeString(),"%z":""+Math.floor(a.getTimezoneOffset()/60)+a.getTimezoneOffset()%60,"%%":"%"};for(var e in d)b=b.replace(e,d[e]);return b}var b='<a href="JavaScript:void(0);" class="dateinput-calendar-cell $PAST $TODAY $SUNDAY" data-year="$YEAR" data-month="$MONTH" data-date="$DATE">$LABEL</a>',c='<a href="JavaScript:void(0);" class="dateinput-calendar-cell dateinput-calendar-othermonth $PAST $TODAY $SUNDAY" data-year="$YEAR" data-month="$MONTH" data-date="$DATE">$LABEL</a>',d='<div class="dateinput-calendar-week">$CELLS</div>',e='<span class="dateinput-weekname $SUNDAY">$LABEL</span>',f=['<div class="dateinput-container $INLINE">','<div class="dateinput-inner">','<div class="dateinput-monthbar">','<span class="dateinput-monthbar-month">$MONTH</span>','<span class="dateinput-monthbar-button dateinput-prevmonth">','<a class="dateinput-prevmonth" href="JavaScript:void(0)">&lt;</a>',"</span>",'<span class="dateinput-monthbar-button dateinput-nextmonth">','<a class="dateinput-nextmonth" href="JavaScript:void(0)">&gt;</a>',"</span>","</div>",'<div class="dateinput-calendar"><div class="dateinput-weeknames">',"$WEEKNAMES","</div>",'<div class="dateinput-calendar-weeks">$CALENDAR</div>',"</div>",'<div class="dateinput-help">$HELP</div>',"</div></div>"].join(""),g=[31,0,31,30,31,30,31,31,30,31,30,31],h="dateinput-past",i="dateinput-today",j="dateinput-sunday",k="dateinput-selected",l="dateinput-inline",m="ssun smon stue swed sthu sfri ssat".split(" "),n="jan feb mar apr may jun jul aug sep oct nov dec".split(" "),o="ljan lfeb lmar lapr lmay ljun ljul laug lsep loct lnov ldec".split(" "),p="jan feb mar apr may jun jul aug sep oct nov dec".split(" "),q="lsun lmon ltue lwed lthu lfri lsat".split(" "),r="sun mon tue wed thu fri sat".split(" "),s=864e5,t="dateinput-calendar-othermonth",D=function(a,b){return b=b>0?b:3,((new Array(1+b)).join("0")+a).slice(-b)},E=function(a,b,c){return c=typeof c=="undefined"?!1:c,a%b||c?0:b};a.fn.dateInput=function(b){a(this).each(function(c,d){function q(a,c){var d=b.labels[n[a.getMonth()]];return f.replace("$INLINE",c?l:"").replace("$WEEKNAMES",weekDays).replace("$MONTH",d+" "+a.getFullYear()).replace("$CALENDAR",C(a.getMonth()+1,a.getFullYear(),b.sundayFirst,b.noPast))}function r(a){a=F(a,b.format,b.labels),g.val(a),g.change()}function u(b){if(!s)return;s.find("."+k).removeClass(k);if(!b)return;s.find(".dateinput-calendar-cell").each(function(c,d){d=a(d);if(d.hasClass(h))return;if(d.data("year")!=b.getFullYear())return;if(d.data("month")!=b.getMonth()+1)return;if(d.data("date")!=b.getDate())return;d.addClass(k)})}function w(c){if(s&&c)s.find(".dateinput-monthbar-month").text(b.labels[n[c.getMonth()]]+" "+c.getFullYear()),s.find(".dateinput-calendar-weeks").html(C(c.getMonth()+1,c.getFullYear(),b.sundayFirst,b.noPast)),s.displayMonth=c.getMonth()+1,s.displayYear=c.getFullYear();else{s=a(q(c||o,b.inline).replace("$HELP",b.inline?"":b.labels.help)),s.displayMonth=o.getMonth()+1,s.displayYear=o.getFullYear(),s.attr("id",(g.attr("id")||g.attr("name"))+"-dateinput"),b.zindex&&s.css("z-index",b.zindex),s.data("input",g),s.data("widget",s),b.inline&&s.css("display","inline-block");function d(a){(function(a){w(a)})(A(new Date(s.displayYear,s.displayMonth-1,1),a)),u(g.val()?new Date(g.val()):null),typeof b.monthChange=="function"&&b.month(newDate.getMonth()+1,newDate.getFullYear()),b.inline||(clearTimeout(v),g.focus())}s.on("contextmenu",function(a){a.preventDefault(),a.stopPropagation();var c=x();w(c),u(c),g.val(F(c,b.format,b.labels)),g.change(),v&&clearTimeout(v),g.focus()}),s.on("click",".dateinput-calendar-cell",function(c){c.stopPropagation(),c.preventDefault();if(a(this).hasClass(h)){v&&clearTimeout(v),g.focus();return}a(this).hasClass(t)&&d(a(this).data("month")>s.displayMonth?1:-1);var e=new Date(a(this).data("year"),a(this).data("month")-1,a(this).data("date"));if(!b.autoClose)v&&clearTimeout(v),g.focus();else{var f=g.closest("form").find(":input");f.eq(f.index(g)+1).focus()}u(e),typeof b.click=="funciton"&&b.click(e)?r(e):r(e)}),s.on("click",".dateinput-monthbar-button a",function(b){b.stopPropagation(),b.preventDefault();var c=a(this);d(c.hasClass("dateinput-prevmonth")?-1:1)})}u(c)}var g=a(d),i={format:"%D %b %Y",autoClose:!1,inline:!1,noPast:!1,startDate:new Date,sundayFirst:!0,offset:4,fadeOut:200,arrowsOnly:!1,labels:{ssun:"S",smon:"M",stue:"T",swed:"W",sthu:"T",sfri:"F",ssat:"S",sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat",lsun:"Sunday",lmon:"Monday",ltue:"Tuesday",lwed:"Wednesday",lthu:"Thursday",lfri:"Friday",lsat:"Saturday",jan:"Jan",feb:"Feb",mar:"Mar",apr:"Apr",may:"May",jun:"Jun",jul:"Jul",aug:"Aug",sep:"Sep",oct:"Oct",nov:"Nov",dec:"Dec",ljan:"January",lfeb:"February",lmar:"March",lapr:"April",ljun:"Jun",ljul:"July",laug:"August",lsep:"September",loct:"October",lnov:"November",ldec:"December",help:"Use Ctrl + arrow keys to navigate"}};b=a.extend(!0,{},i,b);var o=g.val()?new Date(g.val()):b.startDate;b.sundayFirst?weekDays=m:(weekDays=m.slice(1),weekDays.push(m[0]));var p=b.sundayFirst?0:6;weekDays=weekDays.map(function(a,c){return e.replace("$LABEL",b.labels[a]).replace("$SUNDAY",p===c?j:"")}).join("");var s,v;if(b.inline){var y=a('<input type="hidden" name="$NAME" id="$ID" value="$VAL">'.replace("$NAME",g.attr("name")).replace("$ID",g.attr("id")).replace("$VAL",g.val()));g.replaceWith(y),g=y,w(g.val()?new Date(g.val()):null),g.after(s)}else b.arrowsOnly&&g.attr("autocomplete","off"),g.on("focus",function(c){if(s)return!0;(function(a){w(a),u(a)})(g.val()?new Date(g.val()):null),s.appendTo(document.body),s.css({position:"absolute",display:"block"});var d=a(document).scrollLeft(),e=a(document).scrollTop(),f=s.outerWidth(),h=s.outerHeight(),i=g.offset().left-d,j=g.offset().top-e,k=g.outerWidth(),l=g.outerHeight(),m=a(window).width(),n=a(window).height(),o=0,p=0;h+j+l+b.offset>n&&j-h-b.offset>0?p=j-h-b.offset+e:p=j+l+b.offset+e,i+f>m?o=i+k-f+d:o=i+d;if(typeof b.position=="function"){var q=b.position({input:{left:i,top:j,width:k,height:l},calendar:{left:o,top:p,width:f,height:h},viewport:{left:d,top:e,width:m,height:n}});o=q.left+d,p=q.top+e}s.css({left:o,top:p})}),g.on("blur",function(a){v=setTimeout(function(){if(!s)return;s.fadeOut(b.fadeOut,function(){s.remove(),s=undefined})},150)}),g.on("keydown",function(a){function c(c){if(!s)return;a.preventDefault(),a.stopPropagation(),g.val(F(c,b.format,b.labels)),w(c),u(c)}function d(a){var d=new Date(g.val());if(d.toString()==="Invalid Date")return;c(A(d,a)),typeof b.monthChange=="function"&&b.monthChange(d.getFullYear(),d.getMonth()+1)}function e(d){if(b.arrowsOnly||a.ctrlKey&&!a.shiftKey&&!a.altKey&&!a.modKey){a.preventDefault(),a.stopPropagation();var e=new Date(g.val());if(e.toString()==="Invalid Date")c(x());else{var f=B(e,d);if(b.noPast&&f-x()<0)return;console.log(f),c(f)}}}switch(a.which){case 13:if(!s)return;a.preventDefault(),a.stopPropagation(),s.fadeOut(b.fadeOut,function(){s.remove(),s=null});break;case 27:if(!s)return;a.stopPropagation(),a.preventDefault(),s.fadeOut(b.fadeOut,function(){s.remove(),s=undefined});break;case 33:d(-1);break;case 34:d(1);break;case 37:e(-1);break;case 38:e(-7);break;case 39:e(1);break;case 40:e(7)}}),g.on("keyup",function(a){if(!s)return;switch(a.which){case 8:case 9:case 13:case 16:case 17:case 18:case 20:case 27:case 32:case 35:case 36:case 37:case 38:case 39:case 40:case 45:case 144:return;default:var b=new Date(g.val());b.toString()==="Invalid Date"?u():w(b)}})})}});