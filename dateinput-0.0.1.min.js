/**
 * jQuery DateInput
 * *jQuery plugin that provides calendar-based date entry widget*
 *
 * @author Monwara LLC / Branko Vukelic <branko@herdhound.com>
 * @version 0.0.1
 */(function(a){a(function(a){function s(a,b){return a%b===0}function t(a){return s(a,4)||!s(a,100)||s(a,400)?!0:!1}function u(a,b){return a-=1,h[a]?h[a]:t(b)?29:28}function v(){return function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())}(new Date)}function w(a,b,c){var d=v();return d.getFullYear()===a&&d.getMonth()+1===b&&d.getDate()===c}function x(a,b,c){var d=v(),e=new Date(a,b-1,c);return e-d<0}function y(a,b){var c=a.getFullYear()*12+(a.getMonth()+1),d=c+b;return new Date(~~(d/12),d%12-1,1)}function z(a,b,f,g){function B(d){var e=[],f,h;if(d>m)return;for(h=0;h<7;h++){f=d+h+1;if(f>m)return e;e.push(c.replace("$PAST",g&&x(b,a,f)?i:"").replace("$TODAY",w(b,a,f)?j:"").replace("$YEAR",b).replace("$MONTH",a).replace("$DATE",f).replace("$LABEL",f))}return e}function C(a){return a&&y.push(a)}b=typeof b=="number"?b:(new Date).getFullYear(),f=typeof f=="boolean"?f:!0,g=typeof g=="boolean"?g:!1;var h,l,m=u(a,b),n,o,p,q,r,s;switch(a){case 1:n=12,o=b-1,q=2,r=b;break;case 12:n=11,o=b,q=1,r=b+1;break;default:n=a-1,o=r=b,q=a+1}p=u(n,o),s=u(q,r);var t=(new Date(b,a-1,1)).getDay(),v=f?t:t-1;v=v===-1?6:v;var y=[[]];for(h=v;h;h--){var z=p-h+1;y[0].push(d.replace("$PAST",g&&x(o,n,z)?i:"").replace("$TODAY",w(o,n,z)?j:"").replace("$YEAR",o).replace("$MONTH",n).replace("$DATE",z).replace("$LABEL",z))}for(h=1;h<=7-v;h++)y[0].push(c.replace("$PAST",g&&x(b,a,h)?i:"").replace("$TODAY",w(b,a,h)?j:"").replace("$YEAR",b).replace("$MONTH",a).replace("$DATE",h).replace("$LABEL",h));var A=~~((m-7+v)/7);(m-7+v)%7&&A++;for(h=0;h<A;h++)C(B(7-v+h*7));var D=y.length-1,E=7-y[D].length;for(h=1;h<=E;h++)y[D].push(d.replace("$PAST",g&&x(r,q,h)?i:"").replace("$TODAY",w(r,q,h)?j:"").replace("$YEAR",r).replace("$MONTH",q).replace("$DATE",h).replace("$LABEL",h));var F=f?0:6;return y=y.map(function(a){return a.map(function(a,b){return a.replace("$SUNDAY",F===b?k:"")})}),y.map(function(a){return e.replace("$CELLS",a.join(""))}).join("")}function C(a,b,c){var d={"%a":c[r[a.getDay()]],"%A":c[q[a.getDay()]],"%b":c[p[a.getMonth()]],"%B":c[o[a.getMonth()]],"%c":a.toLocaleString(),"%d":A(a.getDate(),2),"%D":a.getDate().toString(),"%H":A(a.getHours(),2,!0),"%i":B(a.getHours(),12),"%I":A(B(a.getHours(),12),2),"%m":A(a.getMonth()+1,2),"%M":A(a.getMinutes(),2,!0),"%N":a.getMinutes().toString(),"%p":a.getHours()>0&&a.getHours()<13?"am":"pm","%s":a.getSeconds().toString(),"%S":A(a.getSeconds(),2,!0),"%w":a.getDay().toString(),"%y":a.getFullYear().toString().slice(-2),"%Y":a.getFullYear().toString(),"%x":a.toLocaleDateString(),"%X":a.toLocaleTimeString(),"%z":""+Math.floor(a.getTimezoneOffset()/60)+a.getTimezoneOffset()%60,"%%":"%"};for(var e in d)b=b.replace(e,d[e]);return b}var b=a("jquery"),c='<a href="JavaScript:void(0);" class="dateinput-calendar-cell $PAST $TODAY $SUNDAY" data-year="$YEAR" data-month="$MONTH" data-date="$DATE">$LABEL</a>',d='<a href="JavaScript:void(0);" class="dateinput-calendar-cell dateinput-calendar-othermonth $PAST $TODAY $SUNDAY" data-year="$YEAR" data-month="$MONTH" data-date="$DATE">$LABEL</a>',e='<div class="dateinput-calendar-week">$CELLS</div>',f='<span class="dateinput-weekname $SUNDAY">$LABEL</span>',g=['<div class="dateinput-container">','<div class="dateinput-inner">','<div class="dateinput-monthbar">','<span class="dateinput-monthbar-month">$MONTH</span>','<span class="dateinput-monthbar-button dateinput-prevmonth">','<a class="dateinput-prevmonth" href="JavaScript:void(0)">&lt;</a>',"</span>",'<span class="dateinput-monthbar-button dateinput-nextmonth">','<a class="dateinput-nextmonth" href="JavaScript:void(0)">&gt;</a>',"</span>","</div>",'<div class="dateinput-calendar"><div class="dateinput-weeknames">',"$WEEKNAMES","</div>",'<div class="dateinput-calendar-weeks">$CALENDAR</div>',"</div></div></div>"].join(""),h=[31,0,31,30,31,30,31,31,30,31,30,31],i="dateinput-past",j="dateinput-today",k="dateinput-sunday",l="dateinput-selected",m="ssun smon stue swed sthu sfri ssat".split(" "),n="jan feb mar apr may jun jul aug sep oct nov dec".split(" "),o="ljan lfeb lmar lapr lmay ljun ljul laug lsep loct lnov ldec".split(" "),p="jan feb mar apr may jun jul aug sep oct nov dec".split(" "),q="lsun lmon ltue lwed lthu lfri lsat".split(" "),r="sun mon tue wed thu fri sat".split(" "),A=function(a,b){return b=b>0?b:3,((new Array(1+b)).join("0")+a).slice(-b)},B=function(a,b,c){return c=typeof c=="undefined"?!1:c,a%b||c?0:b};b.fn.dateInput=function(a){b(this).each(function(c,d){function p(b){var c=a.labels[n[b.getMonth()]];return g.replace("$WEEKNAMES",weekDays).replace("$MONTH",c+" "+b.getFullYear()).replace("$CALENDAR",z(b.getMonth()+1,b.getFullYear(),a.sundayFirst,a.noPast))}function q(b){b=C(b,a.format,a.labels),e.val(b)}function s(a){if(!r)return;r.find("."+l).removeClass(l);if(!a)return;r.find(".dateinput-calendar-cell").each(function(c,d){d=b(d);if(d.hasClass(i))return;if(d.data("year")!=a.getFullYear())return;if(d.data("month")!=a.getMonth()+1)return;if(d.data("date")!=a.getDate())return;d.addClass(l)})}function u(c){r&&c?(r.find(".dateinput-monthbar-month").text(a.labels[n[c.getMonth()]]+" "+c.getFullYear()),r.find(".dateinput-calendar-weeks").html(z(c.getMonth()+1,c.getFullYear(),a.sundayFirst,a.noPast)),r.displayMonth=c.getMonth()+1,r.displayYear=c.getFullYear()):(r=b(p(j)),r.displayMonth=j.getMonth()+1,r.displayYear=j.getFullYear(),r.attr("id",(e.attr("id")||e.attr("name"))+"-dateinput"),a.zindex&&r.css("z-index",a.zindex),r.data("input",e),r.data("widget",r),a.inline&&r.css("display","inline-block"),r.on("click",".dateinput-calendar-cell",function(c){c.stopPropagation(),c.preventDefault();var d=new Date(b(this).data("year"),b(this).data("month")-1,b(this).data("date"));if(!a.autoClose)t&&clearTimeout(t),e.focus();else{var f=e.closest("form").find(":input");f.eq(f.index(e)+1).focus()}s(d),typeof a.click=="funciton"&&a.click(d)?q(d):q(d)}),r.on("click",".dateinput-monthbar-button a",function(c){c.stopPropagation(),c.preventDefault();var d=b(this),f=d.hasClass("dateinput-prevmonth")?-1:1;(function(a){u(a)})(y(new Date(r.displayYear,r.displayMonth-1,1),f)),s(e.val()?new Date(e.val()):null),typeof a.monthChange=="function"&&a.month(newDate.getMonth()+1,newDate.getFullYear()),a.inline||(clearTimeout(t),e.focus())})),s(c)}var e=b(d),h={format:"%D %b %Y",autoClose:!1,inline:!1,noPast:!1,startDate:new Date,sundayFirst:!0,offset:4,fadeOut:200,labels:{ssun:"S",smon:"M",stue:"T",swed:"W",sthu:"T",sfri:"F",ssat:"S",sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat",lsun:"Sunday",lmon:"Monday",ltue:"Tuesday",lwed:"Wednesday",lthu:"Thursday",lfri:"Friday",lsat:"Saturday",jan:"Jan",feb:"Feb",mar:"Mar",apr:"Apr",may:"May",jun:"Jun",jul:"Jul",aug:"Aug",sep:"Sep",oct:"Oct",nov:"Nov",dec:"Dec",ljan:"January",lfeb:"February",lmar:"March",lapr:"April",ljun:"Jun",ljul:"July",laug:"August",lsep:"September",loct:"October",lnov:"November",ldec:"December"}};a=b.extend(!0,{},h,a);var j=e.val()?new Date(e.val()):a.startDate;a.sundayFirst?weekDays=m:(weekDays=m.slice(1),weekDays.push(m[0]));var o=a.sundayFirst?0:6;weekDays=weekDays.map(function(b,c){return f.replace("$LABEL",a.labels[b]).replace("$SUNDAY",o===c?k:"")}).join("");var r,t;if(a.inline){var v=b('<input type="hidden" name="$NAME" id="$ID" value="$VAL">'.replace("$NAME",e.attr("name")).replace("$ID",e.attr("id")).replace("$VAL",e.val()));e.replaceWith(v),e=v,u(e.val()?new Date(e.val()):null),e.after(r)}else e.on("focus",function(c){if(r)return!0;u(e.val()?new Date(e.val()):null),r.appendTo(document.body),r.css({position:"absolute",display:"block"});var d=b(document).scrollLeft(),f=b(document).scrollTop(),g=r.outerWidth(),h=r.outerHeight(),i=e.offset().left-d,j=e.offset().top-f,k=e.outerWidth(),l=e.outerHeight(),m=b(window).width(),n=b(window).height();console.log("~~~",{doffx:d,doffy:f,calW:g,calH:h,inputX:i,inputY:j,inputW:k,inputH:l,winW:m,winH:n});var o=0,p=0;h+j+l+a.offset>n&&j-h-a.offset>0?p=j-h-a.offset+f:p=j+l+a.offset+f,i+g>m?o=i+k-g+d:o=i+d,r.css({left:o,top:p})}),e.on("blur",function(b){t=setTimeout(function(){if(!r)return;r.fadeOut(a.fadeOut,function(){r.remove(),r=undefined})},150)}),e.on("keydown",function(a){if(a.which===27){if(!r)return;r.fadeOut(200,function(){r.remove(),r=undefined})}}),e.on("keyup",function(a){if(!r)return;var b=new Date(e.val());b.toString()==="Invalid Date"?s():u(b)})})}})})(typeof define=="function"&&define.amd?define:function(a){a(function(){return jQuery})});